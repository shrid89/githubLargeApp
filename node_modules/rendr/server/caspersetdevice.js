//Create the object of casper
var casper = require('casper').create();
CasperSetDevice = function() {};
CasperSetDevice.prototype.SetDevice = function(ReqParam) {
   
	//To Start the casper with home page
	casper.start('https://idmsa.apple.com/IDMSWebAuth/login?&appIdKey=891bd3417a7776362562d2197f89480a8547b108fd934911bcbea0110d07f757&path=%2F%2Fmembercenter%2Findex.action', function() {});
	console.log(this.getTitle); return true;
	//To Login to developer site.
	casper.thenEvaluate(function (term) {
        document.querySelector('#accountname').setAttribute('value', "manish630@yahoo.com");
        document.querySelector('#accountpassword').setAttribute('value', "Nad757me");
        document.querySelector('#submitButton2').click();
    }, {
        term: 'CasperJS'
    });

    //To do all the operation - add device id and add provisioning profile			
	casper.waitUntilVisible('.grid2col', function() {			
	    this.click(".last p a");
		this.waitUntilVisible(".portal-section-content", function() {		
			this.click(".license-update .remind-later-button");      
		   	this.waitUntilVisible(".section-links", function() {
                //For Add Device ID
		    	this.click(".devices-ios"); 
		    	this.waitUntilVisible(".content-toolbar", function() {		    	
					this.click(".add"); 
					this.waitUntilVisible("form[name='deviceSave']", function() {									   
					    this.sendKeys('form[name="deviceSave"] input[name = "name" ]', ReqParam.DeviceIDName);
    					this.sendKeys('form[name="deviceSave"] input[name = "deviceNumber" ]', ReqParam.DeviceID);
					    this.click(".submit"); 					    
						this.waitUntilVisible(".ui-dialog-content", function() {
						    casper.then(function () {					        
					        	this.thenOpen("https://developer.apple.com/account/overview.action", function() {							       
							        this.waitUntilVisible(".portal-section-content", function() {										
										this.click(".license-update .remind-later-button");      
									   	this.waitUntilVisible(".section-links", function() {		
									   	    //To add provisioning profile						   		
									   		this.click(".provisioning-profiles"); 
											this.waitUntilVisible(".content-toolbar", function() {	
											    this.waitUntilVisible("#grid-table", function() {
													this.click("td[title='Mockm']");
													this.waitUntilVisible("#grid-table .edit-button", function() {
														this.click("#grid-table .edit-button");													
														this.waitUntilVisible("form[name='profileEdit']", function() {	
																this.click(".selectAll input[type='checkbox']");
																this.click(".submit");
																this.waitUntilVisible(".downloadForm", function() {															        	
														        	this.click(".right");
														        	this.waitUntilVisible(".content-toolbar", function() {	
														        	   this.echo('Provisioning Profile Added Successfully.');											        	   
														        	});
													        	},'',60000); 			
														},'',40000);
													},'',40000);
												},'',40000);
											},'',40000);
										}); 
								   	});
							    });    
					    	});
				    	});
				    });	
		    	});
	    	},'',40000);
	    },'',40000);
	},'',40000);

    casper.run();
}

module.exports = CasperSetDevice;